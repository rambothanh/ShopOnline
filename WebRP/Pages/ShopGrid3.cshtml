@page
@model ShopGrid3Model
@using System.Text.Json

@{
    ViewData["Title"] = "Shop Grid 3";
}
<!--Error message-->
<h3 class="message"></h3>
<!--Page Banner Start-->
<div class="page-banner" style="background-image: url(assets/images/testimonial-bg.jpg);">
    <div class="container">
        <div class="page-banner-content text-center">
            <h2 class="title">Products</h2>
            <ol class="breadcrumb justify-content-center">
                <li class="breadcrumb-item"><a href="index.html">Home</a></li>
                <li class="breadcrumb-item active" aria-current="page">Products</li>
            </ol>
        </div>
    </div>
</div>
<!--Page Banner End-->
<!--Shop Start-->
<div class="shop-page section-padding-6">
    <div class="container">

        <!--Shop Top Bar Start-->
        <div class="shop-top-bar d-sm-flex align-items-center justify-content-between">
            <div class="top-bar-btn">
                <ul class="nav" role="tablist">
                    <li class="nav-item"><a class="nav-link grid active" data-toggle="tab" href="#grid" role="tab"></a>
                    </li>
                    <li class="nav-item"><a class="nav-link list" data-toggle="tab" href="#list" role="tab"></a></li>
                </ul>
            </div>
            <div class="top-bar-sorter">
                <div class="sorter-wrapper d-flex align-items-center">
                    <label>Sort by:</label>
                    <select class="sorter wide" name="SortBy" id="SortBy">
                        <option value="manual">Featured</option>
                        <option value="best-selling">Best Selling</option>
                        <option value="title-ascending">Alphabetically, A-Z</option>
                        <option value="title-descending">Alphabetically, Z-A</option>
                        <option value="price-ascending">Price, low to high</option>
                        <option value="price-descending">Price, high to low</option>
                        <option value="created-descending">Date, new to old</option>
                        <option value="created-ascending">Date, old to new</option>
                    </select>
                </div>
            </div>
            <div class="top-bar-page-amount">
                <p>Showing 1 - 9 of 10 result</p>
            </div>
        </div>
        <!--Shop Top Bar End-->
        <!--Show Products-->
        <div class="tab-content" id="myTabContent">
            <!--Show Products as grid-->
            <div class="tab-pane fade show active" id="grid" role="tabpanel">
                <div class="row">
                    <!--Show divProductGrid here -->


                </div>
            </div>
            <!--Show Products as list-->
            <div class="tab-pane fade" id="list" role="tabpanel">
                <!--Show divProductList here -->


            </div>
        </div>

        <!--Pagination Start-->
        <div class="page-pagination">
            <ul class="pagination justify-content-center">
                <li class="page-item"><a class="page-link prev" href="#">Prev</a></li>
                <li class="page-item"><a class="page-link active" href="#">1</a></li>
                <li class="page-item"><a class="page-link" href="#">2</a></li>
                <li class="page-item"><a class="page-link" href="#">3</a></li>
                <li class="page-item"><a class="page-link next" href="#">Next</a></li>
            </ul>
        </div>
        <!--Pagination End-->


    </div>
</div>
<!--Shop End-->

<script>
    $(document).ready(function () {
        //-------------- AJAX ---------------------
        @* if (!sessionStorage.hasOwnProperty("token")) {
                window.location.href = "Chuyển qua trang đăng nhập";
                } *@
        var options = {};
        options.url = "http://localhost:5000/api/Products";
        options.type = "GET";
        @* options.beforeSend = function (xhr) {
                xhr.setRequestHeader("Authorization", "Bearer " + sessionStorage.getItem("token"));
                $("h3.message").html("Wait...");
                }; *@
            options.dataType = "json";
        options.success = function (data) {

            data.forEach(function (product) {
                //Check quantity of product
                if (product.quantity === 0) {
                    var stickerNew = `<span class="sticker-new soldout-title">Soldout</span>`;
                } else {
                    var stickerNew = `<span class="sticker-new label-sale">-` + product.productPrice.salePercent + `%</span>`;
                }
                //MainProductImage 
                var mainProductImage = "";
                product.productImages.forEach(function (productImage) {
                    if (productImage.isMainPicture) {
                        mainProductImage = productImage.pictureUri;
                        //break; JAVASCRIPT can't break forEach
                    }
                });

                //#region Create product grid
                var divProductGrid = `
                <div class="col-lg-4 col-sm-6">
                    <div class="single-product">
                        <div class="product-image">
                            <a href="shopsingle/`+ product.id + `">
                                 <img src="`+ mainProductImage + `" alt="">
                                @* <img src="https://picsum.photos/384/480" alt=""> *@

                            </a>
                            `+ stickerNew + `
                            <div class="action-links">
                                <ul>
                                    <li><a productId=`+ product.id + ` 
                                    productName=`+ product.name + ` 
                                    currentPrice=`+ product.productPrice.currentPrice + ` 
                                    oldPrice=`+ product.productPrice.oldPrice + ` 
                                    maxQuantity=`+ product.quantity + `
                                    image=`+ mainProductImage + ` 
                                    data-tooltip="tooltip" data-placement="left" title="Add to cart"><i class="icon-shopping-bag"></i></a></li>
                                    <li><a href="compare.html" data-tooltip="tooltip" data-placement="left" title="Compare"><i class="icon-sliders"></i></a></li>
                                    <li><a href="wishlist.html" data-tooltip="tooltip" data-placement="left" title="Add to Wishlist"><i class="icon-heart"></i></a></li>
                                    <li><a href="javascript:void(0);" data-tooltip="tooltip" data-placement="left" title="Quick View" data-toggle="modal" data-target="#Modal`+ product.id + `"><i class="icon-eye"></i></a></li>
                                </ul>
                            </div>

                        </div>
                        <div class="product-content text-center">
                            <ul class="rating">
                                <li class="rating-on"><i class="fa fa-star"></i></li>
                                <li class="rating-on"><i class="fa fa-star"></i></li>
                                <li class="rating-on"><i class="fa fa-star"></i></li>
                                <li class="rating-on"><i class="fa fa-star-half-o"></i></li>
                                <li class="rating-on"><i class="fa fa-star-o"></i></li>
                            </ul>
                            <h4 class="product-name"><a href="shopsingle/`+ product.id + `">` + product.name + `</a></h4>
                            <div class="price-box">
                                <span class="current-price">$`+ product.productPrice.currentPrice + `</span>
                                <span class="old-price">$`+ product.productPrice.oldPrice + `</span>
                            </div>
                        </div>
                    </div>
                </div>`;
                //#endregion Create product grid
                //Add divProduct grid
                $("#grid > div").append(divProductGrid);


                //#region Create product list
                var divProductList = `
                <div class="single-product product-list">
                    <div class="product-image">
                        <a href="shopsingle/`+ product.id + `">
                            <img src="`+ mainProductImage + `" alt="">
                        </a>

                        `+ stickerNew + `

                        <div class="action-links">
                            <ul>
                                <li><a href="javascript:void(0);" data-tooltip="tooltip" data-placement="left" title="Quick View" data-toggle="modal" data-target="#Modal`+ product.id + `"><i class="icon-eye"></i></a></li>
                            </ul>
                        </div>
                    </div>
                    <div class="product-content">
                        <ul class="rating">
                            <li class="rating-on"><i class="fa fa-star-o"></i></li>
                            <li class="rating-on"><i class="fa fa-star-o"></i></li>
                            <li class="rating-on"><i class="fa fa-star-o"></i></li>
                            <li class="rating-on"><i class="fa fa-star-o"></i></li>
                            <li class="rating-on"><i class="fa fa-star-o"></i></li>
                        </ul>
                        <h4 class="product-name"><a href="shopsingle/`+ product.id + `">` + product.name + `</a></h4>
                        <div class="price-box">
                            <span class="current-price">$`+ product.productPrice.currentPrice + `</span>
                            <span class="old-price">$`+ product.productPrice.oldPrice + `</span>
                        </div>
                        <p>`+ product.shortDescription + `</p>

                        <ul class="action-links">
                            <li><a productId=`+ product.id + ` 
                                    productName=`+ product.name + ` 
                                    currentPrice=`+ product.productPrice.currentPrice + ` 
                                    oldPrice=`+ product.productPrice.oldPrice + ` 
                                    maxQuantity=`+ product.quantity + `
                                    image=`+ mainProductImage + `
                                    class="add-cart" data-tooltip="tooltip" data-placement="top" title="Add to cart"> Add to cart </a></li>
                            <li><a href="javascript:void(0);" data-tooltip="tooltip" data-placement="top" title="Add to Wishlist" class="wishlist"><i class="icon-heart"></i></a></li>
                            <li><a href="javascript:void(0);" data-tooltip="tooltip" data-placement="top" title="Compare" class="compare"><i class="icon-sliders"></i></a></li>
                        </ul>
                    </div>
                </div>`;
                //#endregion Create product list

                //Add product list
                $("div#list").append(divProductList);

                //#region Create quick view
                var quickView = `
                <div class="modal fade" id="Modal`+ product.id + `">
                    <div class="modal-dialog modal-dialog-centered">
                        <div class="modal-content">
                            <button type="button" class="btn-close" data-dismiss="modal" aria-label="Close"></button>
                            <div class="modal-body">
                                <div class="row">
                                    <div class="col-md-6">
                                        <div class="quick-view-image">
                                            <img src="`+ mainProductImage + `" alt="">
                                        </div>
                                    </div>
                                    <div class="col-md-6">
                                        <div class="quick-view-content">
                                            <h4 class="product-title">`+ product.name + `</h4>
                                            <div class="thumb-price">
                                                <span class="current-price">$`+ product.productPrice.currentPrice + `</span>
                                                <span class="old-price">$`+ product.productPrice.oldPrice + `</span>
                                                <span class="discount">-`+ product.productPrice.salePercent + `%</span>
                                            </div>
                                            <div class="product-rating">
                                                <ul class="rating-star">
                                                    <li><i class="fa fa-star-o"></i></li>
                                                    <li><i class="fa fa-star-o"></i></li>
                                                    <li><i class="fa fa-star-o"></i></li>
                                                    <li><i class="fa fa-star-o"></i></li>
                                                    <li><i class="fa fa-star-o"></i></li>
                                                </ul>
                                                <span>No reviews</span>
                                            </div>
                                            <p>`+ product.shortDescription + `</p>

                                            <div class="quick-view-quantity-addcart d-flex flex-wrap">
                                                <form action="#">
                                                    <div class="quantity d-inline-flex">
                                                        <button type="button" class="sub"><i class="ti-minus"></i></button>
                                                        <input type="text" value="1" max=`+ product.quantity + ` />
                                                        <button type="button" class="add"><i class="ti-plus"></i></button>
                                                    </div>
                                                </form>
                                                <div class="addcart-btn">
                                                    <button productId=`+ product.id + ` 
                                                            productName=`+ product.name + ` 
                                                            currentPrice=`+ product.productPrice.currentPrice + ` 
                                                            oldPrice=`+ product.productPrice.oldPrice + ` 
                                                            maxQuantity=`+ product.quantity + `
                                                            image=`+ mainProductImage + `
                                                            quickView=true
                                                            class="btn btn-primary">Add to cart</button>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>`;
                //#endregion Create quick view

                //Add quick view
                $("div.main-wrapper").append(quickView);
            });
            //Error message change to ""
            $("h3.message").html("");

            @* if (sessionStorage.hasOwnProperty("message")) {
                    $("h3.message").html(sessionStorage.getItem("message"));
                    sessionStorage.removeItem("message");
                    } *@
        };
        options.error = function (xhr) {
            @* if (xhr.status == 401) {
                    window.location.href = "chuyển đến trang đăng nhập";
                    } *@

                $("h3.message").html("Error while calling the API");
        }
        //Start call API
        $.ajax(options);
    });//-------------- END AJAX ---------------------
</script>
<script src="~/assets/js/cart.js"></script>
